<?php
/**
 * Part of the Laradic packages.
 * MIT License and copyright information bundled with this package in the LICENSE file.
 *
 * @author      Robin Radic
 * @license     MIT
 * @copyright   2011-2015, Robin Radic
 * @link        http://radic.mit-license.org
 */
namespace Sunveloper\TeeplussSupport\Traits;

use Exception;
use Sunveloper\TeeplussSupport\Contracts\Validable;

/**
 * Trait ValidableServiceTrait
 *
 * @package     Sunveloper\TeeplussSupport\Traits
 * @property \Illuminate\Support\MessageBag $errors
 */
trait ValidableServiceTrait
{
    /** @var \Sunveloper\TeeplussSupport\Contracts\Validable[] */
    protected $validators;

    /**
     * Get the value of validators
     *
     * @return mixed
     */
    public function getValidators()
    {
        return $this->validators;
    }

    /**
     * Sets the value of validators
     *
     * @param mixed $validators
     * @return mixed
     */
    public function setValidators($validators)
    {
        $this->validators = $validators;

        return $this;
    }


    /**
     * Run the validation checks on the input data
     *
     * @param array $data
     * @return bool
     * @throws \Exception
     */
    public function runValidationChecks(array $data)
    {
        foreach ($this->validators as $validator)
        {
            if ( $validator instanceof Validable )
            {
                if ( ! $validator->with($data)->passes() )
                {
                    $this->errors = $validator->errors();
                }
            }

            else
            {
                throw new Exception("{$validator} is not an instance of Laradic\\Support\\Contracts\\Validable");
            }
        }

        if ( $this->errors->isEmpty() )
        {
            return true;
        }
    }
}
